<!DOCTYPE html>
<html lang="eng">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,
        initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="stylesheet.css">
    <!--bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!--googlefonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap"
        rel="stylesheet">
    <title>Cozylight Books</title>
</head>

<body>
    <header>
        <!--navbar with collapsable elements-->
        <nav class="navbar navbar-expand-md">
            <div class="container-fluid px-sm-3 px-md-3 px-lg-4 flex-column gap-1">
                <div class="d-flex w-100 py-2 justify-content-between align-items-end">
                    <!--brand/logo-->
                    <div class="pe-3">
                        <a class="navbar-brand" href="/">
                            <img src="images/logo1.png" alt="CozyLight Books" class="img-fluid"
                                style="max-width: 350px;">
                        </a>
                    </div>

                    <!--search bar-->
                    <div class="px-2">
                        <form action="/search" method="post" class="d-flex" role="search">
                            <div class="input-group pb-3">
                                <input class="form-control" type="search" id="navsearch" name="search"
                                    placeholder="Search products" aria-label="Search"
                                    style="height: 50px; font-size: 18px">
                                <button class="btn h-100" type="submit" style="height: 50px; font-size: 18px;">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!--collapsable icon-->
                    <button class="navbar-toggler align-self-end mb-3 mx-2" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false"
                        aria-label="Toggle Navigation" style="height: 50px">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!--collapsable nav items, shown on new row on non-sm screens, collapsed on small screens-->
                <div class="nav-divider mx-auto w-100 my-1"></div>
                <div class="collapse navbar-collapse w-100" id="navbar">
                    <ul class="navbar-nav">
                        <li class="nav-item px-3">
                            <a class="nav-link text-white" href="/books">
                                <strong>Books</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="/bestseller">
                                <strong>Best Sellers</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="news.html">
                                <strong>News</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="aboutUs.html">
                                <strong>About Us</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="contactUs.html">
                                <strong>Contact Us</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="support.html">
                                <strong>Support</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="/writereview">
                                <strong>Reviews</strong>
                            </a>
                        </li>
                        <li class="nav-item px-3">
                            <a class="nav-link text-nowrap text-white" href="/information.html">
                                <strong>Info</strong>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!--Notification for wishlist-->
    <div id="wishlist-notification" class="wishlist-notification hidden"></div>


    <!--banner with background image and captions, along with an overlaying searchbar-->
    <div class="productBackground w-100">
        <div class="d-flex flex-column justify-content-center align-items-center py-5">
            <h2 class="display-5 pt-5 text-white"><strong>Feature Documentation</strong></h2>
            <p class="lead text-white"><strong>How it was done!</strong></p>
        </div>
    </div>

    <!--banner with flavour text-->
    <div class="overlay p-5 w-100 shadow">
        <h2 class="display-6"><strong>Implementing LocalStorage and IndexedDB</strong></h2>
        <p class="lead">
            <strong>By researching, testing, and integrating these concepts, CozyLight has gained new
                features!</strong>
        </p>
    </div>

    <div class="body p-5 m-3 mb-5 rounded shadow scroll-fade">
        <h3 class="display-5"><strong>LocalStorage and IndexedDB, What Are They?</strong></h3>
        <p class="lead">
            To improve the CozyLight website and to demonstrate my excellence in this unit, I have researched, tested,
            and implemented the concepts of localStorage and IndexedDB. My inspiration was a desire to improve the user
            experience when browsing a product selection, and enable a way to locally save user-written content.
        </p>
        <p class="lead">
            The ability to store information locally on the browser offers many benefits that can enhance the user
            experience and bolster website performance. By saving data directly on the user's device, websites like
            CozyLight can provide faster load times, maintain persistent states across viewing session, and enable new
            features. The local persistance of data is especially useful for saving recent activity (viewed products),
            recording personalised preferences (wishlists), and storing incomplete information before being sent to the
            server (written drafts).
        </p>
        <p class="lead">
            The implementation of these topics, especially IndexedDB, were some of the most challengign topics I've
            faced in this course. However, through perseverance, I was able to create features that are both useful and
            that I am proud of.
        </p>
        <h4 class="display-6">localStorage</h4>
        <p class="lead">
            Both localStorage and IndexedDB provide valuable tools for storing data localling in a user's browser.
            However, they each operate differently and excel in different use cases. localStorage is ideal for storing
            lightweight key-value pairs such as user preferences, settings, or product ids. It is accessible using basic
            JavaScript API calls. The simplicity of localStorage is its strength, often being used for quick data
            retrieval and easy storage. I utilised localStorage to store bookIds that allowed me to make API calls on
            CozyLight's book database, creating recently viewed and wishlist functionaltiy.
        </p>
        <h4 class="display-6">IndexedDB</h4>
        <p class="lead">
            Compared to localStorage, IndexedDB is a powerful asynchronous database system that support storing
            structured data such as objects, arrays, and files. IndexedDB is designed specifically for scenarios where
            larger or more complex datasets are needed. Information stored in an IndexedDB is persistent, can be
            updated, and can be queried. This functionality makes it ideal for storing larger objects or array, aligning
            with the needs of book review draft saving, loading, and deleting function. IndexedDB is more complicated to
            access than localstorage, requiring the opening, initiation, transactions, and read/write operations. Error
            handling is also very important, adding new layers of complexity.
        </p>
        <br>
        <p class="lead">
            Thanks to localStorage and IndexedDB, I have implement the following three features into the CozyLight
            webpage. Explanaitions of how they were achieved are provided below.
            <ol>
                <li class="lead"><strong>Recently Viewed Books</strong></li>
                <li class="lead"><strong>Wishlist</strong></li>
                <li class="lead"><strong>Book Review Drafts Storage</strong></li>
            </ol>
        </p>
    </div>

    <div class="body p-5 m-3 mb-5 rounded shadow scroll-fade">
        <h3 class="display-5"><strong>Recently Viewed Books Feature</strong></h3>
        <p class="lead">
            The recently viewed books feature enhances the user experience on CozyLight by showing the product cards for
            the user's 3 most recently viewed books. The feature utilises localStorage to track the book Ids of any
            product visited product page, using the Ids to fetch from the books database, and dynamically display them
            on any page with a recently viewed section.
        </p>
        <p class="lead">
            When a user loads a product page, the book's unqiue ID from the books database is assigned to a global
            variable using a script tag. This variable is passed to a function called saveViewedBook in the
            recentlyViewed.js file. The function is
            responsible for manging the list of recently viewed book ids in localStorage. Inside the function, the
            existing list of recently viewed books is retrieved and parsed from localStorage. If the newly passed ID is
            already in the list, it is removed to prevent duplication. The ID is added to the front of the list, and the
            array is trimmed to store onnly four entries. The updated list is saved into localStorage.
        </p>
        <p class="lead">
            The recentlyViewed.js script using an event handler for DomContentLoaded to wait for the page to load, then
            check whether any recently viewed book IDs exist within localStorage. If they exist and are in the valid
            format, the IDs are sent in a POST request to the server route /recentlyviewed. If the current page is a
            product page, the current ID is removed from the list. This to prevent a currently selected book from
            appearing in the recently viewed section, twice on the same page. The server validates the list, then gets
            all book entries that match the recieved IDs from the books database, returning the results to the
            client-side webpage.
        </p>
        <p class="lead">
            The recieved book data, including title, author, price, and images paths, are used to dynamically populate a
            div with product cards. The purpose of storing four book IDs and only displaying three is to ensure that
            three books are still displayed even when the ID of the currently viewed product page is removed.
        </p>
        <p class="lead">
            This approach allowed me to combine persistent client-side localStorage with dynamic server-side rendering.
            The result is a seamless and personalised browsing experience for all users, which would have been
            unachievable without localStorage.
        </p>
    </div>

    <div class="body p-5 m-3 mb-5 rounded shadow scroll-fade">
        <h3 class="display-5"><strong>Book Wishlist Feature</strong></h3>
        <p class="lead">
            The wishlist feature allows uses to favourite with a heart button any book they are interested in. The book
            will then have a persistent red heart wherever it is shown in the website, and is added to a wishlist
            section on the front page. The wishlist section updates dynamically, with users able to re-click the heart
            button to instantly remove it from the page.
        </p>
        <p class="lead">
            This dynamic feature utilises localStorage to store the currently wishlisted book IDs between sessions and
            webpages. A dynamic DOM manipulation is used to render the wishlist section and the persistent
            heart-wishlist buttons. A POST request is used to fetch the wishlisted book data from the server for
            rendering.
        </p>
        <p class="lead">
            When the page loads through DOMContentLoaded, the wishlist.js script parses the current wishlist stored in
            localStorage and uses it to initialise two things:
        <ol>
            <li class="lead">The heart icons across the website are updated to reflect whether the book is wishlisted or
                not.</li>
            <li class="lead">Current wishlist is rendered into the designated div if a wishlist section exists on the
                page.</li>
        </ol>
        </p>
        <p class="lead">
            on any heart icon across the site triggers a delegated event listener that checks whether the clicked
            book ID is in the wishlist or not. If it is, the book is removed from localStorage and the heart icon is
            changed
            to be emprt. If not, the abook is added and the icon changes to a filled heart. This is handled through the
            toggleWishlist() function.
        </p>
        <p class="lead">
            Whenever a change is made to the wishlist, the updated list is saved to local storage and the icon states
            are immediately refreshed. A notifcation is displayed to inform the user that the book has been added or
            removed from the webpage.
        </p>
        <p class="lead">
            Through integrating localStorage with a server-side database and clever JavaScript function, this appraoch
            esnure the wishlist remains persistent across webpages and sessions, is visually reactive, and updates
            dynamically.
        </p>
    </div>

    <div class="body p-5 m-3 mb-5 rounded shadow scroll-fade">
        <h3 class="display-5"><strong>User-Written Review Draft Feature</strong></h3>
        <p class="lead">
            This feature allows users to write reviews for any of the books existing in the website's books database.
            Through the use of IndexedDB, users can save, load, and delete review drafts from the locally stored
            database. IndexedDB ensures that the reviews are persistent between page loads. Users can then submit their
            finished reviews to the website's server database.
        </p>
        <p class="lead">
            The process begins when the writeReview page is loaded by the user, initialise the reviewDrafts.js script.
            First, the initiateDB() function runs, opening or creating a database named "ReviewsDB" with an object store
            called "reviews". This allows drafts to be stored in a local database in an array format. Each review draft
            can be stored with a unqiue bookID as a key. This set up the ability to store user-written content directly
            in the browser. The use of the bookID as a key ensure that only one draft can exist per book per user on the
            website.
        </p>
        <p class="lead">
            While writing their draft into the form, users have three draft-related options. Clicking the Save Draft
            button calls the saveDraft() function. This opens the "ReviewsDB" and create a new read/write transaction. A
            draft object is created using the selected bookId, written review title, the review content, and a
            timestamp. Object is then saved using store.put(). Any existing draft for the same book is overwritten, or a
            new one is created if none already exists.
        </p>
        <p class="lead">
            The Load Draft button calls the loadDraft() function. First, the bookId value from the select input field
            (where user chooses a book) is retrieved, and an attempt to fetch the corresponding object from the
            IndexedDB is made. If a draft exists, it is passed to a callback function and populate the from with the
            draft (i.e., the title and review content fields). If no draft is found, the user is notified.
        </p>
        <p class="lead">
            Finally, the Delete Draft button calls the deleteDraft() function. Using the same approach as loadDraft(),
            the bookId is retrieved and an attempt to fetch the matching object in the IndexedDB is made. If found, the
            corresponding draft is removed using store.delete(). Once deleted, a confirmation alert is shown.
        </p>
        <p class="lead">
            By utilising IndexedDB, multiple objects containing arrays of information are able to be store locally on
            the browser. This functionality powers the review draft feature, improving the experience for users. The
            same effect would not of been achievable with just localStorage, highlighting the strengths of IndexedDB.
        </p>
    </div>

    <!--universal footer used throughout the website-->
    <footer class="mt-5">
        <div class="container py-4">
            <div class="row gx-5 gy-4">
                <!--discover links-->
                <div class="col-3 ps-5">
                    <p class="h5"><strong>Discover</strong></p>
                    <div class="d-flex flex-column gap-2">
                        <a href="/" class="footerLink">Home</a>
                        <a href="/books" class="footerLink">Books</a>
                        <a href="/bestSeller" class="footerLink">Best Sellers</a>
                        <a href="news.html" class="footerLink">News</a>
                    </div>
                </div>
                <!--about links-->
                <div class="col-3 ps-3">
                    <p class="h5"><strong>About CozyLight</strong></p>
                    <div class="d-flex flex-column gap-2">
                        <a href="aboutUs.html" class="footerLink">About Us</a>
                        <a href="contactUs.html" class="footerLink">Contact Us</a>
                        <a href="support.html" class="footerLink">Support</a>
                    </div>
                </div>
                <!--contact-->
                <div class="col-3 ps-3">
                    <p class="h5"><strong>Contact Us</strong></p>
                    <div class="d-flex flex-column gap-2">
                        <p><strong>Email:</strong> service.cozylight@anemail.com</p>
                    </div>
                </div>
                <!--opening hours-->
                <div class="col-3 ps-2">
                    <p class="h5"><strong>Opening Hours</strong></p>
                    <table id="tableHours" class="table text-center text-white w-75">
                        <tbody class="font-weight-normal">
                            <tr>
                                <td>Mon - Thu:</td>
                                <td>8am - 9pm</td>
                            </tr>
                            <tr>
                                <td>Fri - Sat:</td>
                                <td>8am - 1am</td>
                            </tr>
                            <tr>
                                <td>Sunday:</td>
                                <td>9am - 10pm</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!--copyright-->
        <div class="copyright py-2 text-center">
            <p>@Copyright 2025 CozyLight Books | Last Updated 1/05/2025</p>
        </div>
    </footer>

    <script src="fadeScroll.js"></script>
    <script src="js/recentlyViewed.js"></script>
    <script src="hover.js"></script>
    <script src="js/wishlist.js"></script>

    <!--bootstrap javascript-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>